#include <stdio.h>
#include <time.h>

// Función para intercambiar dos elementos en el arreglo
void swap(int *a, int *b) {
    int temp = *a;
    *a = *b;
    *b = temp;
}

// Función para imprimir el contenido del arreglo
void printArray(int array[], int size) {
    for (int i = 0; i < size; i++) {
        printf("%d ", array[i]);
    }
    printf("\n");
}

// Función de partición utilizando un pivote con doble índice
int partition(int array[], int low, int high) {
    int pivot = array[high];       // Elige el último elemento como pivote
    int leftIndex = low - 1;       // Índice de la izquierda para encontrar elementos mayores que el pivote
    int rightIndex = high;         // Índice de la derecha para encontrar elementos menores que el pivote

    while (1) {
        // Incrementa leftIndex mientras los elementos son menores que el pivote
        do { leftIndex++; } while (array[leftIndex] < pivot);

        // Decrementa rightIndex mientras los elementos son mayores que el pivote
        do { rightIndex--; } while (rightIndex >= low && array[rightIndex] > pivot);

        // Si los índices se cruzan, intercambia el pivote con el elemento en leftIndex
        if (leftIndex >= rightIndex) {
            swap(&array[leftIndex], &array[high]);
            return leftIndex;  // Retorna la posición final del pivote
        }

        // Intercambia los elementos en leftIndex y rightIndex
        swap(&array[leftIndex], &array[rightIndex]);
    }
}

// Función recursiva de Quick Sort para ordenar el arreglo
void quickSort(int array[], int low, int high) {
    if (low >= high) { // Si el subarray tiene 0 o 1 elemento, está ordenado
        return;
    }
    int pivot = partition(array, low, high); // Encuentra la posición del pivote
    quickSort(array, low, pivot - 1);        // Ordena la parte izquierda
    quickSort(array, pivot + 1, high);       // Ordena la parte derecha
}

// Función para calcular el tiempo de ejecución en segundos
double getExecutionTime(struct timespec start, struct timespec end) {
    return (end.tv_sec - start.tv_sec) + (end.tv_nsec - start.tv_nsec) / 1e9;
}

int main() {
    // Arreglo de ejemplo
    int array[] = {10, 4, 7, 2, 8, 9, 1, 5, 6, 3};
    // Arreglo de 1000 elementos unicos
    //int array[] = {8481, 8872, 3258, 8184, 6286, 177, 4671, 7646, 7202, 7765, 8396, 1849, 4620, 7302, 9115, 2575, 531, 9728, 1324, 7146, 8032, 3983, 9207, 2405, 1330, 8217, 4537, 6598, 843, 1143, 9466, 327, 8306, 7354, 8754, 6613, 2774, 5706, 3648, 150, 9580, 2741, 6329, 5051, 5042, 5748, 9151, 770, 1957, 2321, 9373, 127, 1178, 8799, 6917, 8419, 8264, 7830, 5266, 7384, 7540, 6339, 8615, 5402, 8559, 996, 4500, 3551, 7766, 8988, 2750, 3737, 2450, 2271, 7176, 4904, 4101, 5276, 3959, 4378, 396, 723, 4264, 437, 296, 2048, 8859, 7994, 3085, 924, 8107, 4212, 3021, 7206, 5447, 3882, 987, 8241, 6350, 6160, 7440, 8515, 5713, 5900, 8739, 5549, 4243, 8182, 9585, 6656, 5464, 788, 318, 8041, 7160, 4338, 69, 9301, 6173, 6088, 8402, 7166, 3481, 9234, 1184, 3106, 2720, 1868, 6961, 4565, 3171, 3623, 3685, 9624, 2748, 7019, 6606, 2987, 663, 1225, 6898, 5930, 4118, 3839, 2313, 5525, 9823, 4564, 7828, 2001, 1858, 1666, 3977, 2248, 5147, 5323, 40, 4259, 9851, 9737, 8554, 2598, 3664, 1826, 6502, 7592, 8458, 797, 4536, 5724, 594, 1465, 1706, 8319, 3494, 3923, 5950, 3006, 5206, 9277, 5120, 4742, 6693, 8957, 8870, 3532, 8562, 4406, 7192, 3744, 9513, 763, 1976, 8103, 1678, 2870, 4720, 9056, 268, 4652, 1569, 4009, 8257, 2151, 7763, 9958, 5369, 2400, 3576, 7612, 4469, 9646, 5647, 5588, 7527, 8014, 7600, 3930, 1925, 5013, 9108, 9676, 1771, 8603, 7267, 5935, 1878, 6141, 1695, 2590, 9117, 1537, 1534, 5223, 1625, 3836, 8212, 9875, 5078, 3759, 4296, 2862, 7544, 1783, 8060, 7598, 4460, 5182, 3340, 7944, 3903, 1198, 7035, 9167, 8143, 3141, 1536, 3099, 5710, 9583, 6640, 5532, 1524, 3324, 4756, 680, 244, 524, 4579, 9998, 7189, 8066, 6755, 8697, 6785, 9272, 7274, 5966, 694, 1262, 4245, 2008, 490, 3611, 2699, 5270, 4544, 3763, 4473, 9843, 7936, 2928, 6915, 5983, 4134, 9653, 4730, 7068, 5906, 2323, 3621, 1112, 7043, 734, 7493, 7359, 4740, 7812, 7109, 1542, 9482, 4560, 7393, 2125, 2908, 7421, 5111, 6788, 5257, 2906, 9189, 4983, 9235, 3170, 3898, 8491, 444, 4400, 9245, 8965, 8346, 3384, 4893, 2764, 2286, 8363, 1563, 6187, 7390, 9467, 9361, 6836, 3889, 7187, 241, 9404, 3212, 1985, 7300, 4683, 6237, 3949, 2642, 9140, 3943, 2245, 2421, 3829, 9297, 3749, 9158, 8267, 1078, 5604, 6383, 3347, 1039, 5306, 3928, 7782, 2226, 4333, 5712, 4688, 161, 6394, 9945, 3785, 9985, 1522, 8794, 6191, 3094, 6490, 528, 2576, 8499, 3300, 148, 819, 4625, 1922, 6478, 8617, 6252, 2513, 2665, 6047, 8192, 3092, 3274, 8507, 8460, 8771, 1539, 6375, 7711, 1027, 2412, 5053, 2565, 6642, 459, 3394, 8001, 624, 6104, 9868, 6896, 9281, 2704, 2937, 858, 5045, 3313, 959, 2109, 1792, 8645, 7407, 4456, 5046, 5861, 9007, 4147, 5888, 8337, 2866, 5649, 7750, 8927, 7443, 6889, 7816, 430, 4963, 1045, 8433, 9350, 3159, 9871, 284, 9937, 6694, 1527, 6030, 5442, 3541, 7624, 3992, 352, 3702, 3200, 9840, 7374, 1710, 6075, 5819, 6585, 107, 5741, 5621, 6398, 5726, 4954, 2462, 1066, 5415, 7228, 5910, 7892, 4969, 3990, 1115, 248, 8122, 7579, 4103, 4083, 3798, 4251, 3305, 8278, 9025, 3962, 1314, 6209, 498, 79, 2925, 1721, 4728, 4767, 779, 6335, 8891, 1831, 9650, 6646, 898, 2404, 861, 3263, 4975, 5616, 2964, 1683, 2376, 1795, 2279, 4539, 9698, 702, 9496, 4925, 6489, 7992, 1030, 3913, 3330, 5707, 6343, 3636, 9974, 6989, 8270, 3282, 1141, 931, 9803, 7841, 6120, 2219, 4014, 3279, 6747, 5428, 3410, 4438, 4075, 5632, 7199, 6916, 6669, 7233, 2162, 9036, 6751, 7611, 1781, 8513, 5846, 7776, 8095, 1412, 9290, 7853, 271, 4449, 4198, 1475, 4577, 6328, 4129, 8258, 5784, 84, 7008, 7371, 5644, 8790, 6928, 1002, 49, 8511, 841, 7289, 1235, 23, 7886, 7337, 1907, 13, 3439, 597, 6911, 2833, 6981, 8225, 2605, 1408, 428, 8506, 854, 5645, 7386, 8605, 5476, 1594, 8334, 72, 8330, 1081, 3995, 8325, 546, 3856, 449, 592, 1364, 9134, 2993, 9459, 2926, 9969, 9253, 2885, 9610, 7403, 2563, 8148, 2891, 1651, 918, 3756, 1772, 9445, 8382, 6022, 7702, 3678, 4040, 974, 1229, 7966, 7385, 1556, 7555, 519, 8045, 7616, 1350, 4119, 1662, 283, 6965, 1098, 6556, 1123, 6360, 8744, 2522, 9989, 4811, 398, 4946, 8775, 3920, 9387, 3223, 6980, 2708, 2886, 5862, 4376, 7898, 7909, 923, 610, 6429, 8509, 5660, 1007, 1547, 6323, 5556, 2681, 8037, 1714, 6875, 1844, 4145, 4659, 1472, 1813, 1686, 4535, 6524, 6908, 2367, 9849, 4201, 9639, 451, 2931, 8044, 7301, 1284, 9334, 3427, 2194, 2790, 2363, 1462, 5808, 1289, 6060, 8563, 5235, 6357, 2614, 5870, 8937, 8472, 2859, 1120, 4386, 9792, 8826, 927, 7365, 3975, 4506, 3592, 2955, 9435, 6576, 2666, 5361, 2497, 9923, 5894, 5311, 4999, 6094, 454, 9052, 7472, 8414, 699, 1069, 1376, 1372, 2414, 4187, 526, 559, 1001, 7100, 1818, 222, 119, 8275, 3273, 1093, 6076, 5671, 3676, 2673, 4972, 3497, 9034, 4138, 6149, 6368, 9678, 6417, 6619, 6054, 6601, 748, 7447, 8648, 7239, 4794, 2158, 307, 4910, 2873, 1094, 4697, 7246, 489, 7091, 2204, 7856, 4933, 6641, 6557, 2594, 6121, 6503, 5805, 1998, 3832, 1521, 3892, 4623, 979, 5417, 3905, 9380, 6511, 5440, 3739, 2578, 2564, 263, 419, 6366, 8069, 7773, 8149, 8945, 4390, 6407, 2410, 5179, 4858, 9605, 7757, 4771, 1746, 9932, 6097, 1780, 9471, 8654, 8828, 7916, 4753, 2580, 529, 6201, 2174, 2917, 4883, 1882, 44, 6702, 122, 9575, 509, 1286, 8109, 1798, 2579, 1996, 9153, 5387, 6431, 3862, 5278, 9186, 9306, 6761, 3374, 6012, 3366, 2268, 7368, 6039, 7428, 557, 5155, 2690, 1718, 9839, 5177, 4073, 7834, 8114, 8806, 6447, 2815, 4379, 2552, 5804, 4148, 6636, 981, 7298, 3018, 5373, 582, 3878, 4280, 6410, 3214, 1031, 5069, 4410, 9783, 1148, 2213, 4080, 3665, 1533, 460, 8417, 9827, 2919, 4575, 7152, 4673, 3677, 4638, 4993, 4285, 4141, 4019, 6083, 5226, 6462, 2584, 1611, 7381, 2687, 3375, 5921, 2157, 213, 2795, 7463, 6002, 4326, 3771, 2344, 2258, 851, 8366, 6361, 911, 2682, 883, 6161, 5458, 9484, 1379, 9767, 8538, 4819, 4206, 3363, 2554, 5308, 9766, 5886, 4089, 4520, 1802, 4884, 8029, 4992, 4828, 1060, 6956, 3395, 2692, 5322, 904, 1387, 3658, 5968, 1221, 8204, 8596, 6035, 7503, 3642, 5372, 5488, 382, 415, 9550, 3540, 8274, 6590, 4922, 3827, 8781, 1369, 1090, 2035, 7569, 8668, 4693, 1363, 6009, 5658};
    // Arreglo de 1000 elementos con repetidos
    //int array[] = {80, 32, 60, 17, 50, 16, 89, 38, 31, 72, 20, 42, 2, 72, 33, 40, 30, 66, 79, 67, 38, 82, 58, 77, 82, 18, 38, 83, 93, 45, 80, 39, 73, 80, 15, 52, 13, 59, 14, 15, 69, 43, 16, 100, 42, 99, 44, 31, 96, 45, 5, 8, 62, 28, 98, 74, 19, 20, 87, 94, 19, 18, 35, 32, 61, 53, 97, 77, 46, 93, 89, 95, 7, 70, 56, 44, 13, 66, 54, 91, 26, 29, 76, 8, 46, 26, 13, 48, 93, 71, 36, 59, 84, 95, 97, 15, 3, 57, 10, 19, 40, 12, 47, 86, 82, 49, 95, 88, 9, 82, 16, 48, 11, 32, 59, 19, 78, 35, 47, 95, 41, 69, 64, 1, 1, 25, 73, 4, 30, 76, 29, 93, 40, 83, 39, 19, 6, 86, 91, 72, 72, 56, 76, 38, 19, 26, 35, 75, 88, 31, 7, 78, 93, 24, 87, 14, 64, 80, 11, 42, 50, 48, 83, 36, 11, 54, 19, 37, 59, 23, 46, 72, 53, 15, 47, 76, 61, 77, 71, 87, 89, 24, 80, 29, 75, 68, 10, 95, 29, 10, 48, 83, 46, 36, 10, 90, 79, 24, 17, 93, 65, 18, 8, 69, 53, 43, 81, 38, 92, 79, 75, 63, 29, 85, 19, 37, 45, 42, 4, 26, 97, 26, 67, 97, 93, 80, 20, 5, 63, 46, 81, 42, 3, 63, 25, 31, 66, 77, 96, 55, 89, 59, 54, 7, 20, 82, 4, 52, 45, 79, 89, 76, 19, 99, 59, 77, 9, 15, 2, 70, 51, 10, 51, 20, 99, 17, 56, 16, 13, 74, 15, 12, 100, 96, 100, 51, 67, 51, 24, 1, 96, 34, 98, 82, 7, 56, 85, 4, 82, 4, 77, 82, 65, 13, 1, 84, 65, 81, 75, 11, 74, 42, 52, 24, 20, 2, 16, 43, 33, 3, 79, 8, 39, 85, 25, 45, 53, 16, 83, 98, 1, 47, 92, 80, 68, 19, 21, 56, 68, 32, 3, 22, 4, 80, 61, 28, 80, 64, 76, 34, 99, 26, 26, 37, 68, 48, 77, 41, 73, 35, 3, 22, 84, 34, 96, 65, 98, 63, 43, 92, 16, 25, 52, 55, 72, 64, 15, 56, 39, 29, 22, 45, 62, 90, 19, 99, 77, 59, 15, 1, 72, 49, 39, 40, 22, 48, 36, 17, 84, 38, 41, 35, 6, 54, 63, 28, 49, 50, 67, 45, 94, 23, 22, 86, 58, 10, 100, 2, 2, 85, 66, 46, 45, 62, 99, 29, 66, 20, 41, 78, 64, 1, 33, 83, 19, 90, 33, 16, 61, 11, 98, 16, 15, 23, 65, 79, 92, 5, 16, 27, 69, 32, 65, 94, 65, 52, 10, 53, 66, 96, 89, 95, 29, 81, 29, 52, 88, 33, 22, 53, 91, 17, 81, 75, 12, 70, 2, 26, 93, 5, 89, 60, 84, 15, 31, 3, 53, 63, 24, 79, 69, 43, 50, 68, 78, 18, 29, 33, 22, 23, 21, 44, 30, 85, 65, 68, 5, 80, 74, 69, 94, 95, 69, 60, 93, 10, 17, 87, 66, 17, 34, 88, 69, 68, 52, 9, 84, 30, 35, 79, 75, 90, 98, 68, 94, 94, 36, 39, 53, 81, 26, 58, 38, 90, 35, 6, 14, 46, 1, 17, 10, 75, 61, 80, 30, 42, 8, 75, 68, 12, 73, 66, 34, 24, 85, 84, 6, 97, 7, 14, 82, 63, 60, 83, 88, 69, 85, 88, 66, 73, 83, 9, 96, 64, 21, 86, 75, 18, 60, 20, 51, 89, 95, 10, 86, 97, 15, 3, 65, 10, 90, 34, 45, 32, 75, 78, 1, 11, 1, 72, 14, 100, 12, 70, 70, 15, 59, 94, 43, 75, 42, 62, 76, 60, 12, 17, 11, 33, 92, 94, 27, 20, 32, 91, 81, 40, 53, 61, 55, 18, 57, 17, 22, 88, 4, 54, 52, 2, 56, 64, 65, 20, 36, 80, 49, 9, 27, 97, 19, 94, 43, 76, 1, 37, 41, 23, 79, 24, 14, 52, 24, 73, 93, 44, 30, 72, 96, 5, 72, 25, 98, 24, 67, 67, 94, 35, 91, 35, 31, 45, 16, 94, 61, 63, 99, 92, 28, 100, 25, 42, 12, 13, 43, 56, 100, 2, 38, 6, 36, 77, 96, 85, 10, 88, 69, 67, 14, 50, 97, 6, 54, 22, 94, 71, 95, 83, 34, 26, 15, 22, 3, 95, 44, 17, 15, 97, 33, 8, 39, 49, 71, 35, 81, 15, 19, 18, 77, 71, 8, 74, 73, 38, 57, 48, 78, 77, 10, 27, 70, 50, 93, 37, 75, 16, 1, 67, 73, 70, 72, 2, 29, 34, 46, 6, 100, 16, 21, 51, 75, 75, 47, 64, 67, 11, 99, 41, 20, 93, 1, 18, 93, 24, 94, 43, 71, 20, 5, 81, 85, 71, 40, 34, 90, 61, 85, 57, 51, 100, 64, 7, 84, 61, 18, 58, 62, 37, 33, 90, 93, 39, 25, 31, 1, 17, 92, 17, 26, 40, 31, 1, 64, 40, 92, 61, 69, 100, 34, 66, 10, 20, 16, 46, 66, 9, 79, 57, 56, 100, 35, 46, 13, 78, 1, 56, 75, 51, 96, 97, 2, 57, 8, 70, 31, 29, 7, 79, 16, 34, 68, 7, 30, 81, 81, 13, 100, 47, 70, 72, 79, 63, 68, 73, 4, 70, 69, 42, 30, 37, 55, 81, 51, 88, 16, 49, 90, 65, 48, 11, 95, 84, 6, 73, 12, 41, 72, 47, 68, 71, 47, 66, 94, 28, 95, 52, 64, 86, 5, 20, 14, 21, 13, 58, 45, 19, 10, 51, 15, 7, 51, 27, 75, 3, 18, 65, 89, 30, 84, 83, 99, 91, 71, 70, 78, 28, 91, 85, 24, 64, 33, 13, 88, 51, 48, 85, 43, 75, 66, 87, 88, 33, 12, 92, 77, 46, 4, 84, 96, 83, 23, 47, 97, 95, 85, 43, 8, 26, 18, 2, 6, 84, 45, 5, 11, 73, 37, 64, 69, 71, 33, 19, 14, 39, 89, 38, 57, 70, 89, 92, 66, 86, 41, 82, 12, 79, 16, 76, 1, 31, 50, 42};
    int n = sizeof(array) / sizeof(array[0]);

    printf("Array inicial: ");
    printArray(array, n);

    // Configuración para medir tiempo en nanosegundos
    struct timespec start, end;
    clock_gettime(CLOCK_MONOTONIC, &start);

    // Llamar a quickSort para ordenar el arreglo
    quickSort(array, 0, n - 1);

    // Medir tiempo de finalización
    clock_gettime(CLOCK_MONOTONIC, &end);

    // Calcular el tiempo de ejecución en segundos, milisegundos y nanosegundos
    double time_spent_sec = getExecutionTime(start, end);
    double time_spent_ms = time_spent_sec * 1e3;  // Convertir a milisegundos
    double time_spent_ns = time_spent_sec * 1e9;  // En nanosegundos

    printf("\nArray ordenado: ");
    printArray(array, n);

    // Imprimir el tiempo de ejecución en segundos, milisegundos y nanosegundos
    printf("\nTiempo de ejecucion: %.9f segundos\n", time_spent_sec);
    printf("Tiempo de ejecucion: %.6f milisegundos\n", time_spent_ms);
    printf("Tiempo de ejecucion: %.0f nanosegundos\n", time_spent_ns);

    return 0;
}
